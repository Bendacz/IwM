package networking.rmi.server;

import java.rmi.RemoteException;
import java.rmi.server.ServerNotActiveException;
import java.rmi.server.UnicastRemoteObject;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

import networking.rmi.api.Books;
import networking.rmi.api.Person;
import networking.rmi.api.PersonalData;
import networking.rmi.api.Program;
import networking.rmi.api.Service;
import networking.rmi.api.Subjects;
import networking.rmi.api.Trips;
import networking.rmi.api.WeekTimetable;

public class ServiceImpl extends UnicastRemoteObject implements Service {

	public ServiceImpl() throws RemoteException {

	}

	//*************************************************************METHODS************************************************************************//

    //============================================================================================================================================//
	//=============================================================PERSONAL DATA==================================================================//
	//============================================================================================================================================//
	@Override
	public PersonalData insertPersonalData(PersonalData pd) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request insertPersonalData() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "insert into personalData(personalData_id, personalData_registeration_number, personalData_student_name"
					+ ", personalData_birth_date, personalData_birth_location, personalData_PESEL, personalData_father_name"
					+ ", personalData_mother_name, personalData_parents_adress, personalData_parents_mobile_number)"
					+ " values (null, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			//statement.setLong(1, pd.getId());
			statement.setLong(1, pd.getRegisterationNumber());
			statement.setString(2,  pd.getStudentName());
			statement.setDate(3,  Date.valueOf(pd.getBirthDate().toString()));
			statement.setString(4,  pd.getBirthLocation());
			statement.setLong(5, pd.getPESEL());
			statement.setString(6,  pd.getFatherName());
			statement.setString(7,  pd.getMotherName());
			statement.setString(8,  pd.getParentsAddress());
			statement.setString(9,  pd.getParentsMobileNumber());

			statement.executeUpdate();

			ResultSet result = statement.getGeneratedKeys();
			if(result.next()) {
				pd.setId(result.getLong(1));
			}

			result.close();
			System.out.println("[successful]");
			return pd;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void updatePersonalData(PersonalData pd) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request updatePersonalData() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "update personalData set personalData_registeration_number = ?, personalData_student_name = ?"
				+ ", personalData_birth_date = ?, personalData_birth_location = ?, personalData_PESEL = ?"
				+ ", personalData_father_name = ?, personalData_mother_name = ?, personalData_parents_adress = ?"
				+ ", personalData_parents_mobile_number = ?"
				+ " where personalData_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1, pd.getRegisterationNumber());
			statement.setString(2,  pd.getStudentName());
			statement.setDate(3,  Date.valueOf(pd.getBirthDate().toString()));
			statement.setString(4,  pd.getBirthLocation());
			statement.setLong(5, pd.getPESEL());
			statement.setString(6,  pd.getFatherName());
			statement.setString(7,  pd.getMotherName());
			statement.setString(8,  pd.getParentsAddress());
			statement.setString(9,  pd.getParentsMobileNumber());
			statement.setLong(10, pd.getId());

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deletePersonalData(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request deletePersonalData() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "delete from personalData where personalData_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public PersonalData getPersonalDataById(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getPersonalDataById() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "select * from personalData where personalData_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			ResultSet result = statement.executeQuery();

			PersonalData pd = null;
			if(result.next()) {
				pd = new PersonalData();
				pd.setId(result.getLong("personalData_id"));
				pd.setRegisterationNumber(result.getLong("personalData_registeration_number"));
				pd.setStudentName(result.getString("personalData_student_name"));
				pd.setBirthDate(LocalDate.parse(result.getDate("personalData_birth_date").toString()));
				pd.setBirthLocation(result.getString("personalData_birth_location"));
				pd.setPESEL(result.getLong("personalData_PESEL"));
				pd.setFatherName(result.getString("personalData_father_name"));
				pd.setMotherName(result.getString("personalData_mother_name"));
				pd.setParentsAddress(result.getString("personalData_parents_adress"));
				pd.setParentsMobileNumber(result.getString("personalData_parents_mobile_number"));
			}

			result.close();
			System.out.println("[successful]");
			return pd;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public List<PersonalData> getAllPersonalData() throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getAllPersonalData() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		Statement statement = null;

		String sql = "select * from personalData";

		try{
			statement = DatabaseConnection.getConnection().createStatement();
			ResultSet result = statement.executeQuery(sql);

			List<PersonalData> list = new ArrayList<PersonalData>();

			while(result.next()) {
				PersonalData pd = new PersonalData();
				pd.setId(result.getLong("personalData_id"));
				pd.setRegisterationNumber(result.getLong("personalData_registeration_number"));
				pd.setStudentName(result.getString("personalData_student_name"));
				pd.setBirthDate(LocalDate.parse(result.getDate("personalData_birth_date").toString()));
				pd.setBirthLocation(result.getString("personalData_birth_location"));
				pd.setPESEL(result.getLong("personalData_PESEL"));
				pd.setFatherName(result.getString("personalData_father_name"));
				pd.setMotherName(result.getString("personalData_mother_name"));
				pd.setParentsAddress(result.getString("personalData_parents_adress"));
				pd.setParentsMobileNumber(result.getString("personalData_parents_mobile_number"));
				list.add(pd);
			}

			result.close();
			System.out.println("[successful]");
			return list;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	//============================================================================================================================================//
	//=============================================================WEEK TIMETABLE=================================================================//
	//============================================================================================================================================//
	@Override
	public WeekTimetable insertWeekTimetable(WeekTimetable wt) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request insertWeekTimetable() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "insert into weekTimetable(weekTimetable_id, weekTimetable_from, weekTimetable_to"
					+ ", weekTimetable_monday, weekTimetable_teusday, weekTimetable_wednesday, weekTimetable_thursday"
					+ ", weekTimetable_friday)"
					+ " values (null, ?, ?, ?, ?, ?, ?, ?)";
		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			//statement.setLong(1, pd.getId());
			statement.setString(1,  wt.getFrom());
			statement.setString(2,  wt.getTo());
			statement.setString(3,  wt.getMonday());
			statement.setString(4,  wt.getTeusday());
			statement.setString(5,  wt.getWednesday());
			statement.setString(6,  wt.getThursday());
			statement.setString(7,  wt.getFriday());

			statement.executeUpdate();

			ResultSet result = statement.getGeneratedKeys();
			if(result.next()) {
				wt.setId(result.getLong(1));
			}

			result.close();
			System.out.println("[successful]");
			return wt;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void updateWeekTimetable(WeekTimetable wt) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request updateWeekTimetable() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "update weekTimetable set weekTimetable_from = ?, weekTimetable_to = ?"
				+ ", weekTimetable_monday = ?, weekTimetable_teusday = ?, weekTimetable_wednesday = ?"
				+ ", weekTimetable_thursday = ?, weekTimetable_friday = ?"
				+ " where weekTimetable_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setString(1,  wt.getFrom());
			statement.setString(2,  wt.getTo());
			statement.setString(3,  wt.getMonday());
			statement.setString(4,  wt.getTeusday());
			statement.setString(5,  wt.getWednesday());
			statement.setString(6,  wt.getThursday());
			statement.setString(7,  wt.getFriday());
			statement.setLong(8, wt.getId());

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deleteWeekTimetable(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request deleteWeekTimetable() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "delete from weekTimetable where weekTimetable_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public WeekTimetable getWeekTimetableById(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getWeekTimetableById() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "select * from weekTimetable where WeekTimetable_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			ResultSet result = statement.executeQuery();

			WeekTimetable wt = null;
			if(result.next()) {
				wt = new WeekTimetable();
				wt.setId(result.getLong("weekTimetable_id"));
				wt.setFrom(result.getString("weekTimetable_from"));
				wt.setTo(result.getString("weekTimetable_to"));
				wt.setMonday(result.getString("weekTimetable_monday"));
				wt.setTeusday(result.getString("weekTimetable_teusday"));
				wt.setWednesday(result.getString("weekTimetable_wednesday"));
				wt.setThursday(result.getString("weekTimetable_thursday"));
				wt.setFriday(result.getString("weekTimetable_friday"));
			}

			result.close();
			System.out.println("[successful]");
			return wt;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public List<WeekTimetable> getAllWeekTimetable() throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getAllWeekTimetable() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		Statement statement = null;

		String sql = "select * from weekTimetable";

		try{
			statement = DatabaseConnection.getConnection().createStatement();
			ResultSet result = statement.executeQuery(sql);

			List<WeekTimetable> list = new ArrayList<WeekTimetable>();

			while(result.next()) {
				WeekTimetable wt = new WeekTimetable();
				wt.setId(result.getLong("weekTimetable_id"));
				wt.setFrom(result.getString("weekTimetable_from"));
				wt.setTo(result.getString("weekTimetable_to"));
				wt.setMonday(result.getString("weekTimetable_monday"));
				wt.setTeusday(result.getString("weekTimetable_teusday"));
				wt.setWednesday(result.getString("weekTimetable_wednesday"));
				wt.setThursday(result.getString("weekTimetable_thursday"));
				wt.setFriday(result.getString("weekTimetable_friday"));
				list.add(wt);
			}

			result.close();
			System.out.println("[successful]");
			return list;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	//============================================================================================================================================//
	//=============================================================PROGRAM========================================================================//
	//============================================================================================================================================//
	@Override
	public Program insertProgram(Program prog) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request insertProgram() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "insert into program(program_id, program_course_name, program_course_title"
					+ ", program_teacher, program_comments"
					+ " values (null, ?, ?, ?, ?)";
		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			//statement.setLong(1, pd.getId());
			statement.setString(1,  prog.getCourseName());
			statement.setString(2,  prog.getCourseTitle());
			statement.setString(3,  prog.getTeacher());
			statement.setString(4,  prog.getComments());

			statement.executeUpdate();

			ResultSet result = statement.getGeneratedKeys();
			if(result.next()) {
				prog.setId(result.getLong(1));
			}

			result.close();
			System.out.println("[successful]");
			return prog;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void updateProgram(Program prog) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request updateProgram() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "update program set program_course_name = ?, program_course_title = ?"
				+ ", program_teacher = ?, program_comments = ?"
				+ " where program_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setString(1,  prog.getCourseName());
			statement.setString(2,  prog.getCourseTitle());
			statement.setString(3,  prog.getTeacher());
			statement.setString(4,  prog.getComments());
			statement.setLong(5, prog.getId());

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deleteProgram(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request deleteProgram() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "delete from program where program_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public Program getProgramById(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getProgramById() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "select * from program where program_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			ResultSet result = statement.executeQuery();

			Program prog = null;
			if(result.next()) {
				prog = new Program();
				prog.setId(result.getLong("program_id"));
				prog.setCourseName(result.getString("program_course_name"));
				prog.setCourseTitle(result.getString("program_course_title"));
				prog.setTeacher(result.getString("program_teacher"));
				prog.setComments(result.getString("program_comments"));
			}

			result.close();
			System.out.println("[successful]");
			return prog;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public List<Program> getAllProgram() throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getAllProgram() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		Statement statement = null;

		String sql = "select * from program";

		try{
			statement = DatabaseConnection.getConnection().createStatement();
			ResultSet result = statement.executeQuery(sql);

			List<Program> list = new ArrayList<Program>();

			while(result.next()) {
				Program prog = new Program();
				prog.setId(result.getLong("program_id"));
				prog.setCourseName(result.getString("program_course_name"));
				prog.setCourseTitle(result.getString("program_course_title"));
				prog.setTeacher(result.getString("program_teacher"));
				prog.setComments(result.getString("program_comments"));
				list.add(prog);
			}

			result.close();
			System.out.println("[successful]");
			return list;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	//============================================================================================================================================//
	//=============================================================BOOKS==========================================================================//
	//============================================================================================================================================//
	@Override
	public Books insertBooks(Books b) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request insertBooks() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "insert into books(books_id, books_course_name, books_book_title"
					+ ", books_authors, books_publishing_house, books_comments"
					+ " values (null, ?, ?, ?, ?, ?)";
		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			//statement.setLong(1, pd.getId());
			statement.setString(1,  b.getCourseName());
			statement.setString(2,  b.getBookTitle());
			statement.setString(3,  b.getAuthors());
			statement.setString(4,  b.getPublishingHouse());
			statement.setString(5,  b.getComments());

			statement.executeUpdate();

			ResultSet result = statement.getGeneratedKeys();
			if(result.next()) {
				b.setId(result.getLong(1));
			}

			result.close();
			System.out.println("[successful]");
			return b;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void updateBooks(Books b) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request updateBooks() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "update books set books_course_name = ?, books_book_title = ?"
				+ ", books_authors = ?, books_publishing_house = ?, books_comments = ?"
				+ " books_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setString(1,  b.getCourseName());
			statement.setString(2,  b.getBookTitle());
			statement.setString(3,  b.getAuthors());
			statement.setString(4,  b.getPublishingHouse());
			statement.setString(5,  b.getComments());
			statement.setLong(6, b.getId());

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deleteBooks(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request deleteBooks() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "delete from books where books_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public Books getBooksById(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getBooksById() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "select * from books where books_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			ResultSet result = statement.executeQuery();

			Books b = null;
			if(result.next()) {
				b = new Books();
				b.setId(result.getLong("books_id"));
				b.setCourseName(result.getString("books_course_name"));
				b.setBookTitle(result.getString("books_book_title"));
				b.setAuthors(result.getString("books_authors"));
				b.setPublishingHouse(result.getString("books_publishing_house"));
				b.setComments(result.getString("books_comments"));
			}

			result.close();
			System.out.println("[successful]");
			return b;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public List<Books> getAllBooks() throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getAllBooks() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		Statement statement = null;

		String sql = "select * from books";

		try{
			statement = DatabaseConnection.getConnection().createStatement();
			ResultSet result = statement.executeQuery(sql);

			List<Books> list = new ArrayList<Books>();

			while(result.next()) {
				Books b = new Books();
				b.setId(result.getLong("books_id"));
				b.setCourseName(result.getString("books_course_name"));
				b.setBookTitle(result.getString("books_book_title"));
				b.setAuthors(result.getString("books_authors"));
				b.setPublishingHouse(result.getString("books_publishing_house"));
				b.setComments(result.getString("books_comments"));
				list.add(b);
			}

			result.close();
			System.out.println("[successful]");
			return list;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	//============================================================================================================================================//
	//=============================================================SUBJECTS=======================================================================//
	//============================================================================================================================================//
	@Override
	public Subjects insertSubjects(Subjects s) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request insertSubjects() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "insert into subjects(subjects_id, subjects_date, subjects_number"
					+ ", subjects_course_name, subjects_subject, subjects_present, subjects_absent"
					+ ", subjects_teacher)"
					+ " values (null, ?, ?, ?, ?, ?, ?, ?)"; //tutaj mog¹ by nulle
		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			//statement.setLong(1, pd.getId());
			statement.setDate(1,  Date.valueOf(s.getDate().toString()));
			statement.setLong(2, s.getNumber());
			statement.setString(3,  s.getCourseName());
			statement.setString(4,  s.getSubject());
			statement.setLong(5, s.getPresent());
			statement.setLong(6, s.getAbsent());
			statement.setString(7, s.getTeacher());

			statement.executeUpdate();

			ResultSet result = statement.getGeneratedKeys();
			if(result.next()) {
				s.setId(result.getLong(1));
			}

			result.close();
			System.out.println("[successful]");
			return s;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void updateSubjects(Subjects s) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request updateSubjects() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "update subjects set subjects_date = ?, subjects_number = ?"
				+ ", subjects_course_name = ?, subjects_subject = ?, subjects_present = ?"
				+ ", subjects_absent = ?, subjects_teacher = ?"
				+ " where subjects_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setDate(1,  Date.valueOf(s.getDate().toString()));
			statement.setLong(2, s.getNumber());
			statement.setString(3,  s.getCourseName());
			statement.setString(4,  s.getSubject());
			statement.setLong(5, s.getPresent());
			statement.setLong(6, s.getAbsent());
			statement.setString(7, s.getTeacher());
			statement.setLong(8, s.getId());

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deleteSubjects(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request deleteSubjects() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "delete from subjects where subjects_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public Subjects getSubjectsById(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getSubjectsById() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "select * from subjects where subjects_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			ResultSet result = statement.executeQuery();

			Subjects s = null;
			if(result.next()) {
				s = new Subjects();
				s.setId(result.getLong("subjects_id"));
				s.setDate(LocalDate.parse(result.getDate("subjects_date").toString()));
				s.setNumber(result.getLong("subjects_number"));
				s.setCourseName(result.getString("subjects_course_name"));
				s.setSubject(result.getString("subjects_subject"));
				s.setPresent(result.getLong("subjects_present"));
				s.setAbsent(result.getLong("subjects_absent"));
				s.setTeacher(result.getString("subjects_teacher"));
			}

			result.close();
			System.out.println("[successful]");
			return s;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public List<Subjects> getAllSubjects() throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getAllSubjects() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		Statement statement = null;

		String sql = "select * from subjects";

		try{
			statement = DatabaseConnection.getConnection().createStatement();
			ResultSet result = statement.executeQuery(sql);

			List<Subjects> list = new ArrayList<Subjects>();

			while(result.next()) {
				Subjects s = new Subjects();
				s.setId(result.getLong("subjects_id"));
				s.setDate(LocalDate.parse(result.getDate("subjects_date").toString()));
				s.setNumber(result.getLong("subjects_number"));
				s.setCourseName(result.getString("subjects_course_name"));
				s.setSubject(result.getString("subjects_subject"));
				s.setPresent(result.getLong("subjects_present"));
				s.setAbsent(result.getLong("subjects_absent"));
				s.setTeacher(result.getString("subjects_teacher"));
				list.add(s);
			}

			result.close();
			System.out.println("[successful]");
			return list;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	//============================================================================================================================================//
	//=============================================================TRIPS==========================================================================//
	//============================================================================================================================================//
	@Override
	public Trips insertTrips(Trips t) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request insertTrips() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "insert into trips(trips_id, trpis_beggining_date, trips_end_date"
					+ ", trips_duration, trips_participants, trips_destination, trips_teacher"
					+ " values (null, ?, ?, ?, ?, ?, ?)"; //tutaj mog¹ by nulle
		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			//statement.setLong(1, pd.getId());
			statement.setDate(1,  Date.valueOf(t.getBegginingDate().toString()));
			statement.setDate(2,  Date.valueOf(t.getEndDate().toString()));
			statement.setLong(3, t.getDuration());
			statement.setLong(4, t.getParticipants());
			statement.setString(5,  t.getDestination());
			statement.setString(6,  t.getTeacher());

			statement.executeUpdate();

			ResultSet result = statement.getGeneratedKeys();
			if(result.next()) {
				t.setId(result.getLong(1));
			}

			result.close();
			System.out.println("[successful]");
			return t;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void updateTrips(Trips t) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request updateTrips() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "update trips set trpis_beggining_date = ?, trips_end_date = ?"
				+ ", trips_duration = ?, trips_participants = ?, trips_destination = ?"
				+ ", trips_teacher = ?"
				+ " where trips_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setDate(1,  Date.valueOf(t.getBegginingDate().toString()));
			statement.setDate(2,  Date.valueOf(t.getEndDate().toString()));
			statement.setLong(3, t.getDuration());
			statement.setLong(4, t.getParticipants());
			statement.setString(5,  t.getDestination());
			statement.setString(6,  t.getTeacher());
			statement.setLong(7, t.getId());

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deleteTrips(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request deleteTrips() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "delete from trips where trips_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public Trips getTripsById(Long id) throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getTripsById() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "select * from trips where trips_id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			ResultSet result = statement.executeQuery();

			Trips t = null;
			if(result.next()) {
				t = new Trips();
				t.setId(result.getLong("trips_id"));
				t.setBegginingDate(LocalDate.parse(result.getDate("trpis_beggining_date").toString()));
				t.setEndDate(LocalDate.parse(result.getDate("trips_end_date").toString()));
				t.setDuration(result.getLong("trips_duration"));
				t.setParticipants(result.getLong("trips_participants"));
				t.setDestination(result.getString("trips_destination"));
				t.setTeacher(result.getString("trips_teacher"));
			}

			result.close();
			System.out.println("[successful]");
			return t;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public List<Trips> getAllTrips() throws RemoteException {
		try {
			System.out.println("\nClient " + getClientHost() + " request getAllTrips() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		Statement statement = null;

		String sql = "select * from trips";

		try{
			statement = DatabaseConnection.getConnection().createStatement();
			ResultSet result = statement.executeQuery(sql);

			List<Trips> list = new ArrayList<Trips>();

			while(result.next()) {
				Trips t = new Trips();
				t.setId(result.getLong("trips_id"));
				t.setBegginingDate(LocalDate.parse(result.getDate("trpis_beggining_date").toString()));
				t.setEndDate(LocalDate.parse(result.getDate("trips_end_date").toString()));
				t.setDuration(result.getLong("trips_duration"));
				t.setParticipants(result.getLong("trips_participants"));
				t.setDestination(result.getString("trips_destination"));
				t.setTeacher(result.getString("trips_teacher"));
				list.add(t);
			}

			result.close();
			System.out.println("[successful]");
			return list;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	//============================================================================================================================================//
	//=============================================================EVENTS=========================================================================//
	//============================================================================================================================================//


	//============================================================================================================================================//
	//=============================================================ADDITIONAL BEHAVIOUR===========================================================//
	//============================================================================================================================================//


	//============================================================================================================================================//
	//============================================================================================================================================//
	//============================================================================================================================================//
	@Override
	public Person insertPerson(Person person) throws RemoteException {
		try {
			System.out.println("\nClient" + getClientHost() + " request insertPerson() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "insert into person(id, first_name, last_name, birth_date) values (null, ?, ?, ?)";
		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
			statement.setString(1, person.getFirstName());
			statement.setString(2,  person.getLastName());
			statement.setDate(3,  Date.valueOf(person.getBirthDate().toString()));

			statement.executeUpdate();

			ResultSet result = statement.getGeneratedKeys();
			if(result.next()) {
				person.setId(result.getLong(1));
			}

			result.close();
			System.out.println("[successful]");
			return person;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void updatePerson(Person person) throws RemoteException {
		try {
			System.out.println("\nClient" + getClientHost() + " request updatePerson() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "update person set first_name = ?"
				+ ", last_name = ?, birth_date = ?"
				+ " where id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setString(1, person.getFirstName());
			statement.setString(2,  person.getLastName());
			statement.setDate(3,  Date.valueOf(person.getBirthDate().toString()));
			statement.setLong(4, person.getId());

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
		}
	}

	@Override
	public void deletePerson(Long id) throws RemoteException {
		try {
			System.out.println("\nClient" + getClientHost() + " request deletePerson() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "delete from person where id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			statement.executeUpdate();
			System.out.println("[successful]");

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public Person getPersonById(Long id) throws RemoteException {
		try {
			System.out.println("\nClient" + getClientHost() + " request getPersonById() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		PreparedStatement statement = null;

		String sql = "select * from person where id = ?";

		try {
			statement = DatabaseConnection.getConnection().prepareStatement(sql);
			statement.setLong(1,  id);

			ResultSet result = statement.executeQuery();

			Person person = null;
			if(result.next()) {
				person = new Person();
				person.setId(result.getLong("id"));
				person.setFirstName(result.getString("first_name"));
				person.setLastName(result.getString("last_name"));
				person.setBirthDate(LocalDate.parse(result.getDate("birth_date").toString()));
			}

			result.close();
			System.out.println("[successful]");
			return person;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

	@Override
	public List<Person> getAllPerson() throws RemoteException {
		try {
			System.out.println("\nClient" + getClientHost() + " request getAllPerson() method...");
		} catch (ServerNotActiveException ex) {
			ex.printStackTrace();
		}

		Statement statement = null;

		String sql = "select * from person";

		try{
			statement = DatabaseConnection.getConnection().createStatement();
			ResultSet result = statement.executeQuery(sql);

			List<Person> list = new ArrayList<Person>();

			while(result.next()) {
				Person person = new Person();
				person.setId(result.getLong("id"));
				person.setFirstName(result.getString("first_name"));
				person.setLastName(result.getString("last_name"));
				person.setBirthDate(LocalDate.parse(result.getDate("birth_date").toString()));
				list.add(person);
			}

			result.close();
			System.out.println("[successful]");
			return list;

		} catch (SQLException ex) {
			System.out.println("[failed]");
			ex.printStackTrace();
			return null;
		} finally {
			if(statement != null) {
				try {
					statement. close();
				} catch (SQLException ex) {
					ex.printStackTrace();
				}
			}
			try {
				DatabaseConnection.getConnection().close();
			} catch (SQLException ex) {
				ex.printStackTrace();
			}
		}
	}

}
